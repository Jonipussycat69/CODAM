#include "push_swap.h"

static short	char_check(char *str)
{
	if (!str)
		return (err);
	while (*str)
	{
		if (*str != ' ' && ps_isdigit(*str) != ok)
			return (err);
		str++;
	}
	return (ok);
}

static char	*input_to_string(int argc, char **argv, t_misc *m)
{
	char	*str;
	int		i;

	if (argc == 2)
	{
		if (char_check(argv[1]) != ok)
			return (NULL);
		return (argv[1]);
	}
	i = 1;
	str = NULL;
	while (i < argc)
	{
		str = ps_strjoin(argv[i], str, 0, 0);
		if (!str)
			return (NULL);
		str = ps_strjoin(" ", str, 0, 0);
		if (!str)
			return (NULL);
		i++;
	}
	if (char_check(str) != ok)
		return (free(str), NULL);
	m->str_to_free = str;
	return (str);
}

static void	sorting(t_list **head_a, t_list **head_b, t_sort *s)
{
	if (check_sort_asc(head_a) != ok && s->total_inp > 3)
	{
		weigh_sort(head_a, head_b, s);
		hardsort(head_a, head_b, st_a);
		printf("len b = %d\n", list_len(head_b));// TEST!
		mark_sort_pa(head_a, head_b, s);
	}
	else if (check_sort_asc(head_a) != ok)
		hardsort(head_a, head_b, st_a);
	print_values(head_a, 'a');// TEST!
	print_values(head_b, 'b');// TEST!
}

static short	ft_pushswap(t_list **head_a, t_sort *s)
{
	t_list	*first;
	t_list	**head_b;

	first = NULL;
	head_b = &first;
	if (!*head_a)
		return (err);
	sorting(head_a, head_b, s);
	free_list(head_a);
	free_list(head_b);
	return (ok);
}

int	main(void)// TEST MAIN
{
	const char	input[] = "73 23 217 312 3173 -3 93 233 4232 5435 35 5343 5353 654 34 4756 772226 65426 6546 62562 26 62642562 24626542 624626 25462642 425626542 42626426 254624642";
	// const char	input[] = "73 23 217 312 3173 -3";
	// const char	input[] = "-6255 -90207 -63182 60319 -43028 -86582 77871 -87983 42305 -23345 -1575 17690 -71254 -98662 -39284 52356 91566 -69495 -77401 -89773 -92930 52031 -69589 32942 -95586 -81215 -96909 -40424 -39183 92280 -10108 81936 78202 -95680 -6330 86525 70743 -14954 36347 -33367 13500 -22401 -83125 -15999 22828 -96358 -43253 -262 -27258 -39692";
	// const char	input[] = "-47280 -80856 99883 -25906 -70867 -21775 -68559 -63130 -30923 1177 -2953 14752 10677 -36667 -48521 -32502 -72957 4467 -61722 -32594 50595 94171 -6873 96545 96340 68169 -39328 -78097 60696 81897 65129 85342 81139 -23176 -66926 -82799 13571 -36596 -51302 -69074 27839 -77140 43721 54208 -95108 11215 91303 25824 -41310 -69460 39656 75982 -82161 -37862 2788 4307 -93750 -40928 62277 15495 87961 -67597 81331 -41003 -72424 -19092 34324 72535 74916 -22649 10262 -46479 -45442 74458 24789 -73823 97313 -65847 -94038 95150 10942 -21098 2521 -31783 8117 -74271 -39248 -80635 -57027 7187 49455 -91049 -62474 26527 -23964 95826 46579 -43170 -78412 -49821 -81596 4783 -76730 43577 -45916 2088 60995 77312 -47481 -88895 -33130 -35366 -17357 -77593 94590 26415 -22168 -55230 7005 98008 30028 -70459 -73033 10290 22355 97907 -60798 83253 82377 -99576 -89310 -80385 58221 58758 -66126 -80208 -71530 68726 -66462 -17977 96958 34530 -19628 42086 28866 -15145 26050 -89887 63615 16625 71193 60755 -4282 -1446 -61481 90309 73404 50700 42413 -15241 85761 -81561 71492 98136 49679 87487 90921 30154 -78292 -88484 -62869 -13373 6274 63226 -62309 -50130 55333 96241 36279 -62882 58970 -36452 -99706 -80024 -89610 -18662 49096 20528 92522 39157 41575 -33795 -87724 -48900 -25492 -25712 90389 15753 90300 87625 81637 -68864 42143 33656 90282 -7239 33160 39450 50174 73567 -14839 6798 -2413 7726 9133 72217 -67239 -87565 -32662 -90855 18727 -48795 97937 59460 -26400 -43211 71663 86776 12183 -9005 68655 9001 -16925 22560 -64311 96147 -96895 -74140 -70838 54037 16670 23793 37701 -76098 77407 25062 -8603 -16998 81721 -81021 -61807 81713 -46329 -89945 -2582 87163 -2715 -53246 -83937 70089 -85234 81936 -98196 59372 -66674 -10633 54326 -92643 7783 -68987 94496 84730 96239 94871 51407 -7650 -91048 74756 -2331 -92831 2829 -87750 14475 3404 80518 99543 83442 7844 -52441 93675 80644 6364 39668 97607 -28629 -35387 -4275 7094 94815 74014 24604 11171 -27358 -44761 60872 34747 74 -45821 87053 -80437 -92268 83917 9729 72568 -41198 47466 73298 48520 -97435 47877 -12913 -86170 39557 -886 -37064 -98174 -22943 86859 -87386 13584 48590 -8781 -9215 84463 25865 92518 -77773 13018 -68498 -43375 20627 38822 -595 8586 76365 -63445 49712 28574 52216 49007 10587 15413 69237 -98456 -52695 99628 72616 49639 4241 7375 -35087 28210 -77026 -88137 -66134 -2949 44174 87264 -79862 -39410 -60202 89257 47801 20250 44626 -83628 -4470 -85412 -8410 -88674 -53886 -92652 -90406 -19067 -18877 -40047 -28198 35122 -75474 -4459 -75168 -7792 -10096 -7242 56373 -71265 6758 -81838 46791 -56838 -91399 38654 34153 74272 -9647 85365 77693 -98668 57564 -13936 31822 -81143 -63984 -43053 13698 6260 -68016 93281 4397 -80944 23017 8815 -11628 -28019 92389 -2642 -54240 10228 -93281 -87093 179 88026 50684 1002 39113 29026 -53459 -25372 78021 83902 -74623 -19364 61325 -90735 -49960 2565 89524 -39011 58504 -88838 29210 13300 -53794 229 1417 65406 55569 -75321 -2236 41970 36614 61017 -34806 -32565 -34138 -53829 -42855 -95980 43120 -92695 50048 42931 -67889 91431 -16459 -95453 -86082 80168 53045 -66903 -32353 -13677 -94033 98458 30325 93362 -28613 38260 -32089 72332 -41667 50299 18985 60650 13958 60139 -67602 29746 13447 85205";
	short	ret;
	t_list	*first;
	t_list	**head;
	t_sort	s;
	t_misc	m;

	first = NULL;
	head = &first;
	m.str_to_free = NULL;
	// if (argc <= 1)
	// 	return (-1);
	if (parser((char *)input, head) != ok)
		return (wr_a("Error"), -1);
	if (m.str_to_free)
		free(m.str_to_free);
	if (indexer(head) != ok)
		return (wr_a("Error"), -1);
	assign_mark(head);
	s.total_inp = list_len(head);
	print_values(head, 'a');
	print_width_format("-", "");
	if (ft_pushswap(head, &s) != ok)
		return (wr_a("Error"), -1);
	printf("THE END\n");
	return (0);
}

// int	main(int argc, char **argv)
// {
// 	short	ret;
// 	t_list	*first;
// 	t_list	**head;
// 	t_sort	s;
// 	t_misc	m;

// 	first = NULL;
// 	head = &first;
// 	m.str_to_free = NULL;
// 	if (argc <= 1)
// 		return (-1);
// 	if (parser(input_to_string(argc, argv, &m), head) != ok)
// 		return (wr_a("Error"), -1);
// 	if (m.str_to_free)
// 		free(m.str_to_free);
// 	if (indexer(head) != ok)
// 		return (wr_a("Error"), -1);
// 	assign_mark(head);
// 	s.total_inp = list_len(head);
// 	if (ft_pushswap(head, &s) != ok)
// 		return (wr_a("Error"), -1);
// 	free_list(head);
// 	return (0);
// }
